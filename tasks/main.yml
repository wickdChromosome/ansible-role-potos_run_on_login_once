---

# If list is explicitly defined to be empty, quit
# Loop over all script names
#- name: Make sure scripts list not empty
#  ansible.bulitin.debug:
#    msg: 
#  failed_when: | length == 0

# Loop over all script names, make an autostart desktopfile for each
- name: Copy over the desktop file to the new dir
  ansible.builtin.template:
    src: "etc/xdg/autostart/desktopfile.j2"
    dest: "/etc/xdg/autostart/{{ item.script | basename }}.desktop"
    force: yes
    mode: '0777'
  loop: "{{ potos_xdg_autostart }}"

# Copy over script file to global autostart dir
- name: Copy over the script file to the new dir
  ansible.builtin.template:
    src: "{{ item.script | replace('/', '', 1) }}" #remove begin slash
    dest: "/usr/local/bin/{{ item.script | basename }}"
    force: yes
    mode: '0777'
  loop: "{{ potos_xdg_autostart }}"

# Append disable script to each copied over script
- name: Copy over sound setting script
  ansible.builtin.blockinfile:
    path: "/usr/local/bin/{{ item.script | basename }}"
    block: "{{ lookup('file', 'files/disable_script.sh') }}"
    state: present
  loop: "{{ potos_xdg_autostart }}"
  when: item.runonlyonce


